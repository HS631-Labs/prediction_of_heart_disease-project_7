---
title: "Heart Disease"
author: "Shannon Walsh"
date: "11/1/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Chunk 1: #Libraries 
```{r}
library(plotly)
library(stats)
library(tidyr)
library(ggplot2)
library(dplyr)
library(data.table)
library(tidyverse)
library(pastecs)
library(dbplyr)
library(Hmisc)
library(scales)
library(ROSE)
library(corrplot)
library(pscl)
library(DT)
library(caret)
library(varImp)
```

#Chunk 2: Working directory 
```{r}
getwd()
```

#Chunk 3: Read in the data 
```{r}
heart_dataframe <- read.csv("./data/heart.csv")
head(heart_dataframe)
str(heart_dataframe)
```


#Chunk 4: Check NAs and for select variable check for missing/invalid data 
Missing data checked for variables Age, RestingBP, Cholesterol and MaxHR, as these are the variables where a value zero is not valid. Missing/Zero values replaced by NA
```{r}
colSums(is.na(heart_dataframe))

invalid_Age <- heart_dataframe$Age == 0
heart_dataframe$Age[invalid_Age] <- NA

invalid_RestingBP<- heart_dataframe$RestingBP == 0
heart_dataframe$RestingBP[invalid_RestingBP] <- NA

invalid_Cholesterol <- heart_dataframe$Cholesterol == 0
heart_dataframe$Cholesterol[invalid_Cholesterol]<- NA

invalid_MaxHR <- heart_dataframe$MaxHR == 0
heart_dataframe$MaxHR[invalid_MaxHR] <- NA
summary(heart_dataframe)
```

#Chunk 5: DataType Conversion
```{r}
#sex
heart_dataframe$Sex[heart_dataframe$Sex == "F"] <- "Female"
heart_dataframe$Sex[heart_dataframe$Sex == "M"] <- "Male"
heart_dataframe$Sex <- as.factor(heart_dataframe$Sex)


#ChestPainType
heart_dataframe$ChestPainType[heart_dataframe$ChestPainType == "TA"] <- "Typical angina"
heart_dataframe$ChestPainType[heart_dataframe$ChestPainType == "ATA"] <- "Atypical angina"
heart_dataframe$ChestPainType[heart_dataframe$ChestPainType == "NAP"] <- "Non-anginal pain"
heart_dataframe$ChestPainType[heart_dataframe$ChestPainType == "ASY"] <- "Asymptomatic angina"
heart_dataframe$ChestPainType <- as.factor(heart_dataframe$ChestPainType)


#FastingBS 
heart_dataframe$FastingBS[heart_dataframe$FastingBS == 0] <- "Low  (<120 mg/dl)"
heart_dataframe$FastingBS[heart_dataframe$FastingBS == 1] <- "High (>120 mg/dl)"
heart_dataframe$FastingBS <- as.factor(heart_dataframe$FastingBS)

#RestingECG
heart_dataframe$RestingECG[heart_dataframe$RestingECG == "Normal"] <- "0 (normal)"
heart_dataframe$RestingECG[heart_dataframe$RestingECG == "ST"] <- "1 (ST)"
heart_dataframe$RestingECG[heart_dataframe$RestingECG == "LVH"] <- "2 (LVH)"
heart_dataframe$RestingECG <- as.factor(heart_dataframe$RestingECG)

#Exercise induced angina
heart_dataframe$ExerciseAngina[heart_dataframe$ExerciseAngina == "N"] <- "No"
heart_dataframe$ExerciseAngina[heart_dataframe$ExerciseAngina == "Y"] <- "Yes"
heart_dataframe$ExerciseAngina <- as.factor(heart_dataframe$ExerciseAngina)

#ST Slope
heart_dataframe$ST_Slope <- as.factor(heart_dataframe$ST_Slop)

#Heart Disease
heart_dataframe$HeartDisease[heart_dataframe$HeartDisease == "0"] <- "Health"
heart_dataframe$HeartDisease[heart_dataframe$HeartDisease == "1"] <- "Heart Disease"
heart_dataframe$HeartDisease <- as.factor(heart_dataframe$HeartDisease)

head(heart_dataframe,20)
summary(heart_dataframe)
str(heart_dataframe)
```

#Chunk 6: Characterizing distributions of variables
Bar plots used for factor variables and Histograms for continuous variables. 
```{r}

#Age 
barplot_age <-heart_dataframe %>%
  group_by(Age) %>%
  count() %>%
  filter(n>10) %>%
  ggplot()+
  geom_col(aes(Age,n), fill = "Blue")+
  ggtitle("Age distribution of the Heart Disease Dataset")
barplot_age
stat.desc(heart_dataframe$Age, basic = FALSE, norm = TRUE)
#Age of majority of subjects falls between 50-60years. Skewed slightly negative skew. Kurtosis    


#Sex
gender_distribution <- ggplot(heart_dataframe, aes( x= heart_dataframe$Sex, fill = heart_dataframe$Sex))+
  geom_bar()+
  xlab("Gender")+
  ylab("count")+
  ggtitle("Distribution of Gender")+
  scale_fill_discrete(name = "Gender", labels = c("Female","Male"))
gender_distribution
#Dataset contains significantly higher number of males(700) compared to females (200)

#Chest Pain Types
CP_distribution <- ggplot(heart_dataframe, aes( x= heart_dataframe$ChestPainType, fill = heart_dataframe$ChestPainType))+
  geom_bar()+
  xlab("Types of Chest Pain")+
  ylab("Count")+
  ggtitle("Distribution of Types of Chest Pain")+
  scale_fill_discrete(name = "Types of Chest Pain", labels = c("Asymptomatic", "Atypica", "Non-Anginal", "Typical"))
CP_distribution


#Fasting blood sugar 
BS_distribution <- ggplot(heart_dataframe, aes( x= heart_dataframe$FastingBS, fill = heart_dataframe$FastingBS))+
  geom_bar()+
  xlab("Fasting Blood Sugar Levels in mg/dl")+
  ylab("count")+
  ggtitle("Distribution of Fasting Blood Sugar Levels")+
  scale_fill_discrete(name = "Blood Sugar Levels", labels = c(">120 mg/dl","<120 mg/dl"))
BS_distribution

#Resting ECG
ECG_distribution <- ggplot(heart_dataframe, aes( x= heart_dataframe$RestingECG, fill = heart_dataframe$RestingECG))+
  geom_bar()+
  xlab("Resting ECG Results")+
  ylab("count")+
  ggtitle("Distribution of Resting ECG Results")+
  scale_fill_discrete(name = "ECG Results", labels = c("Normal", "ST", "LVH"))
ECG_distribution


#Exercise induced angina
Exangina_distribution <- ggplot(heart_dataframe, aes( x= heart_dataframe$ExerciseAngina, fill = heart_dataframe$ExerciseAngina))+
  geom_bar()+
  xlab("presence or absence of exercise induced angina ")+
  ylab("count")+
  ggtitle("Presence or Absence of Exercise Induced Angina")+
  scale_fill_discrete(name = "Exercise Induced Angina", labels = c("Absence","Presence"))
Exangina_distribution

#ST Slope
ST_distribution <- ggplot(heart_dataframe, aes( x= heart_dataframe$ST_Slope, fill = heart_dataframe$ST_Slope))+
  geom_bar()+
  xlab("ST Slope nature")+
  ylab("count")+
  ggtitle("Distribution of nature of the ST Slopes")+
  scale_fill_discrete(name = "ST Slopes", labels = c("Down", "Flat", "Up"))
ST_distribution

#Heart disease 
heartdisease_distribution <- ggplot(heart_dataframe, aes( x= heart_dataframe$HeartDisease, fill = heart_dataframe$HeartDisease))+
  geom_bar()+
  xlab("Heart Disease")+
  ylab("count")+
  ggtitle("Presence and absence of heart disease")+
  scale_fill_discrete(name = "Heart Disease", labels = c("Absence", "presence"))
heartdisease_distribution
prop.table(table(heart_dataframe$HeartDisease)) 

#Within the data set ~55.3% have heart disease and ~44.7% do not. Which is nearly a balanced dataset. 


#Histograms for continuous integer/dbl variables 
#Cholesterol
cholesterol_distribution <- ggplot(heart_dataframe, aes( x= heart_dataframe$Cholesterol, fill = heart_dataframe$Cholesterol))+
  geom_histogram(color = "Black", fill = "Chocolate")+
  xlab("Serum Cholesterol Levels in mg/dl")+
  ylab("count")+
  ggtitle("Distribution of Serum Cholesterol Levels across database")
cholesterol_distribution 
stat.desc(heart_dataframe$Cholesterol, basic = FALSE, norm = TRUE)

#Cholesterol Levels appears to be normally distributed with negative kurtosis. The distribution also shows significant outliers to the right which may make the distribution to the positively skewed?  


#Resting BP 
BP_distribution <- ggplot(heart_dataframe, aes( x= heart_dataframe$RestingBP, fill = heart_dataframe$RestingBP))+
  geom_histogram(color = "Black", fill = "brown")+
  xlab("Blood Pressure is mmHg")+
  ylab("count")+
  ggtitle("Distribution of Resting Blood Pressure Readings")
BP_distribution 
stat.desc(heart_dataframe$RestingBP, basic = FALSE, norm = TRUE)

# Slight positive skew with Negative Kurtosis i.e. several values father from mean and outliers at both ends. 


#MaxHR
HR_distribution <- ggplot(heart_dataframe, aes( x= heart_dataframe$MaxHR, fill = heart_dataframe$MaxHR))+
  geom_histogram(color = "Black", fill = "darkorchid1")+
  xlab("Maximum Heart Rate in bpm")+
  ylab("count")+
  ggtitle("Distribution of Maximum Heart Rate across database")
HR_distribution 
stat.desc(heart_dataframe$MaxHR, basic = FALSE, norm = TRUE)

#Data is slightly Negatively skewed. Majority of the subjects' MaxHR falls 125-150bpm and Leptokurtik with kurtosis of -4.6 i.e. Heavy tailed with values father from mean.  

#oldpeak
Oldpeak_distribution <- ggplot(heart_dataframe, aes( x= heart_dataframe$Oldpeak, fill = heart_dataframe$Oldpeak))+
  geom_histogram(color = "Black", fill = "cadetblue")+
  xlab("Oldpeak - ST depression induced by exercise relative to rest")+
  ylab("count")+
  ggtitle("Distribution of ST depression induced by exercise relative to rest")
Oldpeak_distribution 
stat.desc(heart_dataframe$Oldpeak, basic = FALSE, norm = TRUE)

#Positively skewed data 
```


#Correlation
```{r}
#Between blood pressure and chest pain type grouped by gender 

cp_bp<- ggplot(heart_dataframe, aes(ChestPainType, RestingBP, color = Sex)) +
geom_boxplot() + 
ggtitle("Spread of resting blood pressure and chestpain time grouped by gender")+
scale_color_manual(values = c("#FF5733","#00BFC4","#4885ed"))
cp_bp
```

